<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>TTPlayè®¿é—®å·¥å…· - ä¿®å¤ç‰ˆ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 10px;
        }
        .btn {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            background: #007acc;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            text-align: center;
        }
        .btn:hover {
            background: #005fa3;
        }
        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
            width: auto;
            display: inline-block;
            margin: 5px;
        }
        .status {
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            display: none;
        }
        .success {
            background: #e8f5e8;
            border-left: 4px solid #28a745;
            color: #155724;
        }
        .error {
            background: #ffe6e6;
            border-left: 4px solid #dc3545;
            color: #721c24;
        }
        .loading {
            background: #e6f3ff;
            border-left: 4px solid #007acc;
            color: #004085;
        }
        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow: auto;
            max-height: 300px;
            font-size: 14px;
        }
        .data-box {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸµ TTPlayè®¿é—®å·¥å…·</h1>
        <p style="text-align: center; color: #666;">
            è®¿é—® <code>http://ttplay.muaini.cn</code>
        </p>
        
        <div id="status" class="status"></div>
        
        <button class="btn" id="testBtn" onclick="testConnection()">ğŸ”— æµ‹è¯•è¿æ¥</button>
        <button class="btn" id="fetchBtn" onclick="getData()">ğŸ“¥ è·å–æ•°æ®</button>
        <button class="btn" onclick="clearAll()">ğŸ—‘ï¸ æ¸…é™¤ç»“æœ</button>
        
        <div style="text-align: center; margin: 20px 0;">
            <a href="http://ttplay.muaini.cn" target="_blank" style="color: #007acc; text-decoration: none;">
                ğŸŒ è®¿é—®åŸç½‘ç«™
            </a>
        </div>
        
        <div id="result" style="display: none;">
            <h3>ğŸ“Š ç»“æœ</h3>
            <div id="resultContent"></div>
        </div>
        
        <div style="margin-top: 30px; padding: 15px; background: #e7f3ff; border-radius: 5px;">
            <h4>ğŸ“ ä½¿ç”¨è¯´æ˜</h4>
            <ol style="margin: 10px 0 10px 20px;">
                <li>ç‚¹å‡»"æµ‹è¯•è¿æ¥"æ£€æŸ¥ç½‘ç»œ</li>
                <li>ç‚¹å‡»"è·å–æ•°æ®"è·å–æœåŠ¡å™¨ä¿¡æ¯</li>
                <li>å¦‚æœå¤±è´¥ï¼Œæ£€æŸ¥æ§åˆ¶å°(F12)é”™è¯¯</li>
            </ol>
        </div>
    </div>
    
    <script>
        // ==== æ ¸å¿ƒå‡½æ•° ====
        
        // æ˜¾ç¤ºçŠ¶æ€
        function showStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = message;
            statusDiv.className = 'status ' + type;
            statusDiv.style.display = 'block';
            console.log('çŠ¶æ€:', type, message);
        }
        
        // æµ‹è¯•è¿æ¥
        async function testConnection() {
            showStatus('æ­£åœ¨æµ‹è¯•è¿æ¥...', 'loading');
            console.log('å¼€å§‹æµ‹è¯•è¿æ¥');
            
            try {
                const btn = document.getElementById('testBtn');
                btn.disabled = true;
                btn.innerHTML = 'â³ è¿æ¥ä¸­...';
                
                // ä½¿ç”¨å¯é çš„ä»£ç†
                const response = await fetch('https://corsproxy.io/?' + encodeURIComponent('http://ttplay.muaini.cn'));
                
                console.log('è¿æ¥å“åº”:', response.status, response.statusText);
                
                if (response.ok) {
                    showStatus('âœ… è¿æ¥æˆåŠŸï¼çŠ¶æ€ç : ' + response.status, 'success');
                } else {
                    showStatus('âŒ è¿æ¥å¤±è´¥: ' + response.status, 'error');
                }
                
            } catch (error) {
                console.error('è¿æ¥é”™è¯¯:', error);
                showStatus('âŒ è¿æ¥é”™è¯¯: ' + error.message, 'error');
            } finally {
                const btn = document.getElementById('testBtn');
                btn.disabled = false;
                btn.innerHTML = 'ğŸ”— æµ‹è¯•è¿æ¥';
            }
        }
        
        // è·å–æ•°æ®
        async function getData() {
            showStatus('æ­£åœ¨è·å–æ•°æ®...', 'loading');
            console.log('å¼€å§‹è·å–æ•°æ®');
            
            const btn = document.getElementById('fetchBtn');
            btn.disabled = true;
            btn.innerHTML = 'â³ è·å–ä¸­...';
            
            try {
                // æ–¹æ³•1: ä½¿ç”¨alloriginsä»£ç†
                const proxyUrl = 'https://api.allorigins.win/raw?url=' + encodeURIComponent('http://ttplay.muaini.cn');
                console.log('ä½¿ç”¨ä»£ç†:', proxyUrl);
                
                const response = await fetch(proxyUrl);
                const text = await response.text();
                
                console.log('è·å–æˆåŠŸï¼Œé•¿åº¦:', text.length);
                
                // æ˜¾ç¤ºç»“æœ
                showResult(text);
                showStatus('âœ… è·å–æˆåŠŸï¼é•¿åº¦: ' + text.length + ' å­—ç¬¦', 'success');
                
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                saveToStorage(text);
                
            } catch (error) {
                console.error('è·å–æ•°æ®é”™è¯¯:', error);
                showStatus('âŒ è·å–å¤±è´¥: ' + error.message, 'error');
                
                // å°è¯•å¤‡ç”¨æ–¹æ³•
                tryBackup();
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'ğŸ“¥ è·å–æ•°æ®';
            }
        }
        
        // å¤‡ç”¨æ–¹æ³•
        async function tryBackup() {
            console.log('å°è¯•å¤‡ç”¨æ–¹æ³•...');
            showStatus('å°è¯•å¤‡ç”¨æ–¹æ³•...', 'loading');
            
            try {
                // å¤‡ç”¨ä»£ç†
                const backupUrl = 'https://thingproxy.freeboard.io/fetch/' + encodeURIComponent('http://ttplay.muaini.cn');
                const response = await fetch(backupUrl);
                const text = await response.text();
                
                console.log('å¤‡ç”¨æ–¹æ³•æˆåŠŸï¼Œé•¿åº¦:', text.length);
                showResult(text);
                showStatus('âœ… å¤‡ç”¨æ–¹æ³•æˆåŠŸï¼é•¿åº¦: ' + text.length, 'success');
                
            } catch (backupError) {
                console.error('å¤‡ç”¨æ–¹æ³•ä¹Ÿå¤±è´¥:', backupError);
                showStatus('âŒ æ‰€æœ‰æ–¹æ³•éƒ½å¤±è´¥äº†', 'error');
            }
        }
        
        // æ˜¾ç¤ºç»“æœ
        function showResult(text) {
            const resultDiv = document.getElementById('result');
            const contentDiv = document.getElementById('resultContent');
            
            let html = '<div class="data-box">';
            html += '<p><strong>æ•°æ®é•¿åº¦:</strong> ' + text.length + ' å­—ç¬¦</p>';
            
            if (text.length > 0) {
                // æ˜¾ç¤ºå‰500å­—ç¬¦
                const preview = text.substring(0, 500);
                html += '<p><strong>é¢„è§ˆ:</strong></p>';
                html += '<pre>' + escapeHtml(preview) + (text.length > 500 ? '...' : '') + '</pre>';
                
                // åˆ†æå†…å®¹
                html += '<p><strong>åˆ†æ:</strong></p>';
                html += '<ul>';
                
                if (text.includes('<html')) {
                    html += '<li>âœ… åŒ…å«HTMLæ ‡ç­¾</li>';
                }
                if (text.includes('åƒåƒé™å¬') || text.includes('æ­Œè¯')) {
                    html += '<li>âœ… åŒ…å«æ­Œè¯ç›¸å…³å†…å®¹</li>';
                }
                if (text.includes('ä¸‹è½½') || text.includes('download')) {
                    html += '<li>âœ… åŒ…å«ä¸‹è½½ä¿¡æ¯</li>';
                }
                if (text.length < 200) {
                    html += '<li>âš ï¸ æ•°æ®è¾ƒçŸ­ï¼Œå¯èƒ½æ˜¯éªŒè¯é¡µé¢</li>';
                }
                
                html += '</ul>';
                
                // æŸ¥çœ‹å®Œæ•´æ•°æ®æŒ‰é’®
                html += '<button class="btn-small" onclick="viewFullData()">æŸ¥çœ‹å®Œæ•´æ•°æ®</button>';
            }
            
            html += '</div>';
            
            contentDiv.innerHTML = html;
            resultDiv.style.display = 'block';
        }
        
        // æŸ¥çœ‹å®Œæ•´æ•°æ®
        function viewFullData() {
            const data = localStorage.getItem('ttplay_full_data');
            if (data) {
                document.getElementById('resultContent').innerHTML = 
                    '<h4>å®Œæ•´æ•°æ®:</h4><pre style="max-height:500px;">' + escapeHtml(data) + '</pre>' +
                    '<button class="btn-small" onclick="getData()">è¿”å›</button>';
            } else {
                alert('æ²¡æœ‰æ‰¾åˆ°ä¿å­˜çš„å®Œæ•´æ•°æ®');
            }
        }
        
        // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
        function saveToStorage(text) {
            try {
                // ä¿å­˜å®Œæ•´æ•°æ®ï¼ˆæœ€å¤š5000å­—ç¬¦ï¼‰
                const dataToSave = text.length > 5000 ? text.substring(0, 5000) : text;
                localStorage.setItem('ttplay_full_data', dataToSave);
                localStorage.setItem('ttplay_last_update', new Date().toISOString());
                console.log('æ•°æ®å·²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨');
            } catch (e) {
                console.warn('æœ¬åœ°å­˜å‚¨å¤±è´¥:', e);
            }
        }
        
        // æ¸…é™¤æ‰€æœ‰
        function clearAll() {
            document.getElementById('status').style.display = 'none';
            document.getElementById('result').style.display = 'none';
            document.getElementById('resultContent').innerHTML = '';
            console.log('å·²æ¸…é™¤æ‰€æœ‰æ˜¾ç¤ºç»“æœ');
        }
        
        // HTMLè½¬ä¹‰
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // ==== é¡µé¢åˆå§‹åŒ– ====
        window.onload = function() {
            console.log('=== TTPlayè®¿é—®å·¥å…·å·²åŠ è½½ ===');
            console.log('é¡µé¢URL:', window.location.href);
            console.log('ç”¨æˆ·ä»£ç†:', navigator.userAgent);
            
            // æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
            showStatus('ğŸŸ¢ å·¥å…·å·²å°±ç»ªï¼Œç‚¹å‡»æŒ‰é’®å¼€å§‹', 'success');
            
            // æ£€æŸ¥æ˜¯å¦æœ‰å†å²æ•°æ®
            if (localStorage.getItem('ttplay_full_data')) {
                console.log('æ£€æµ‹åˆ°å†å²æ•°æ®');
                document.getElementById('result').style.display = 'block';
                document.getElementById('resultContent').innerHTML = 
                    '<p>æ£€æµ‹åˆ°ä¹‹å‰ä¿å­˜çš„æ•°æ®ã€‚</p>' +
                    '<button class="btn-small" onclick="viewFullData()">æŸ¥çœ‹å†å²æ•°æ®</button>' +
                    '<button class="btn-small" onclick="getData()">è·å–æ–°æ•°æ®</button>';
            }
        };
    </script>
</body>
</html>
