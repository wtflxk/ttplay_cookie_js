<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åƒåƒé™å¬æ­Œè¯æœåŠ¡å™¨è®¿é—®å·¥å…·</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .btn {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            background: #007acc;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            text-align: center;
            text-decoration: none;
        }
        .btn:hover {
            background: #005fa3;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            display: none;
        }
        .success {
            border-left: 4px solid #28a745;
            background: #e8f5e8;
        }
        .error {
            border-left: 4px solid #dc3545;
            background: #ffe6e6;
        }
        .loading {
            border-left: 4px solid #007acc;
            background: #e6f3ff;
        }
        .cookie-box {
            background: #fff3cd;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸµ åƒåƒé™å¬æ­Œè¯æœåŠ¡å™¨è®¿é—®å·¥å…·</h1>
        <p>é€šè¿‡GitHub Pagesä»£ç†è®¿é—® <code>http://ttplay.muaini.cn</code></p>
        
        <div id="status" class="result"></div>
        
        <button class="btn" onclick="getData()">ğŸš€ å¼€å§‹è·å–æ•°æ®</button>
        <button class="btn" onclick="showCookies()">ğŸª æŸ¥çœ‹Cookie</button>
        <button class="btn" onclick="clearCookies()">ğŸ—‘ï¸ æ¸…é™¤Cookie</button>
        
        <a href="proxy.html" class="btn" style="background: #28a745;">
            ğŸ”§ æ‰“å¼€ä»£ç†é¡µé¢ï¼ˆæ–°çª—å£ï¼‰
        </a>
        
        <div id="cookieResult" class="result"></div>
        
        <div id="dataResult" class="result" style="display:none;">
            <h3>è·å–åˆ°çš„æ•°æ®ï¼š</h3>
            <div id="dataContent"></div>
        </div>
        
        <div style="margin-top: 30px; padding: 15px; background: #e7f3ff; border-radius: 5px;">
            <h3>ğŸ“ ä½¿ç”¨è¯´æ˜ï¼š</h3>
            <ol>
                <li>ç‚¹å‡»"å¼€å§‹è·å–æ•°æ®"æŒ‰é’®</li>
                <li>ç­‰å¾…å‡ ç§’é’Ÿè·å–æ•°æ®</li>
                <li>ç³»ç»Ÿä¼šè‡ªåŠ¨è®¾ç½®Cookie</li>
                <li>å¯ä»¥æŸ¥çœ‹æˆ–æ¸…é™¤Cookie</li>
                <li>éœ€è¦æ—¶é‡æ–°è·å–</li>
            </ol>
            <p><strong>æ³¨æ„ï¼š</strong>å¦‚æœç›´æ¥è®¿é—®å¤±è´¥ï¼Œè¯·ç‚¹å‡»"æ‰“å¼€ä»£ç†é¡µé¢"</p>
        </div>
    </div>
    
    <script>
        // æ˜¾ç¤ºçŠ¶æ€
        function showStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.innerHTML = message;
            status.className = `result ${type}`;
            status.style.display = 'block';
        }
        
        // è·å–æ•°æ®
        async function getData() {
            showStatus('æ­£åœ¨è¿æ¥æœåŠ¡å™¨...', 'loading');
            
            try {
                // ä½¿ç”¨è·¨åŸŸä»£ç†
                const proxyUrl = 'https://api.allorigins.win/raw?url=' + 
                                encodeURIComponent('http://ttplay.muaini.cn');
                
                const response = await fetch(proxyUrl);
                
                if (response.ok) {
                    const text = await response.text();
                    
                    showStatus('âœ… æˆåŠŸè·å–æ•°æ®ï¼', 'success');
                    
                    // æ˜¾ç¤ºéƒ¨åˆ†æ•°æ®
                    document.getElementById('dataContent').innerHTML = 
                        `<pre>${text.substring(0, 500)}...</pre>` +
                        `<p>æ€»é•¿åº¦: ${text.length} å­—ç¬¦</p>`;
                    document.getElementById('dataResult').style.display = 'block';
                    
                    // è®¾ç½®Cookie
                    setCookie('ttplay_data', btoa(text), 7);
                    setCookie('ttplay_access_time', new Date().toISOString(), 7);
                    
                    // æå–é‡è¦ä¿¡æ¯
                    extractAndSetCookies(text);
                    
                } else {
                    showStatus('âŒ æœåŠ¡å™¨é”™è¯¯: ' + response.status, 'error');
                }
                
            } catch (error) {
                showStatus('âŒ è¿æ¥å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        // æå–ä¿¡æ¯å¹¶è®¾ç½®Cookie
        function extractAndSetCookies(html) {
            // æå–æ ‡é¢˜
            const titleMatch = html.match(/<title>(.*?)<\/title>/);
            if (titleMatch && titleMatch[1]) {
                setCookie('ttplay_title', encodeURIComponent(titleMatch[1]), 7);
            }
            
            // æå–ä¸‹è½½å¯†ç 
            const passwordMatch = html.match(/ä¸‹è½½å¯†ç [ï¼š:]\s*(\w+)/);
            if (passwordMatch && passwordMatch[1]) {
                setCookie('ttplay_password', passwordMatch[1], 7);
            }
            
            // æå–æ›´æ–°æ—¶é—´
            const updateMatch = html.match(/(\d{4}-\d{2}-\d{2})æ›´æ–°/);
            if (updateMatch && updateMatch[1]) {
                setCookie('ttplay_update', updateMatch[1], 7);
            }
        }
        
        // è®¾ç½®Cookie
        function setCookie(name, value, days) {
            const expires = new Date();
            expires.setTime(expires.getTime() + days * 24 * 60 * 60 * 1000);
            document.cookie = `${name}=${value};expires=${expires.toUTCString()};path=/`;
            console.log('å·²è®¾ç½®Cookie:', name);
        }
        
        // æ˜¾ç¤ºCookie
        function showCookies() {
            const cookies = document.cookie;
            const result = document.getElementById('cookieResult');
            
            if (cookies) {
                let html = '<h3>å½“å‰Cookieï¼š</h3>';
                cookies.split(';').forEach(cookie => {
                    const [name, value] = cookie.trim().split('=');
                    html += `<div class="cookie-box">${name} = ${decodeURIComponent(value || '')}</div>`;
                });
                result.innerHTML = html;
} else {
result.innerHTML = '<p>æš‚æ— Cookie</p>';
}
            
result.style.display = 'block';
result.className = 'result success';
}
        
// æ¸…é™¤Cookie
function clearCookies() {
document.cookie.split(';').forEach(cookie => {
const name = cookie.split('=')[0].trim();
document.cookie = `${name}=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/`;
});
showStatus('âœ… æ‰€æœ‰Cookieå·²æ¸…é™¤', 'success');
document.getElementById('cookieResult').style.display = 'none';
}
        
// é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
window.onload = function() {
showStatus('å°±ç»ªï¼ç‚¹å‡»"å¼€å§‹è·å–æ•°æ®"æŒ‰é’®', 'success');
};
    

