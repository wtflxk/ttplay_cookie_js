<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>TTPlayå¢å¼ºç‰ˆè®¿é—®å·¥å…·</title>
    <style>
        body { font-family: Arial; padding: 20px; max-width: 800px; margin: 0 auto; }
        .btn { 
            padding: 15px 30px; 
            margin: 10px 5px; 
            background: #007acc; 
            color: white; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 16px; 
        }
        .btn:hover { background: #005fa3; }
        .status { 
            padding: 15px; 
            margin: 15px 0; 
            border-radius: 5px; 
            border-left: 5px solid #007acc;
            background: #e6f3ff;
        }
        .success { border-left-color: #28a745; background: #e8f5e8; }
        .error { border-left-color: #dc3545; background: #ffe6e6; }
        pre { 
            background: #f5f5f5; 
            padding: 15px; 
            border-radius: 5px; 
            overflow: auto; 
            max-height: 500px;
            border: 1px solid #ddd;
        }
        .method-group { margin: 20px 0; }
        .method-btn { 
            padding: 10px 20px; 
            margin: 5px; 
            background: #6c757d; 
            color: white; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
        }
        .method-btn:hover { background: #545b62; }
        .method-btn.active { background: #007acc; }
    </style>
</head>
<body>
    <h1>ğŸ”§ TTPlayå¢å¼ºç‰ˆè®¿é—®å·¥å…·</h1>
    <p>ç›®æ ‡ï¼š<code>http://ttplay.muaini.cn</code></p>
    
    <div id="status" class="status"></div>
    
    <div class="method-group">
        <h3>é€‰æ‹©æ–¹æ³•ï¼š</h3>
        <button class="method-btn active" onclick="selectMethod(1)">æ–¹æ³•1: ç›´æ¥ä»£ç†</button>
        <button class="method-btn" onclick="selectMethod(2)">æ–¹æ³•2: æ·»åŠ è¯·æ±‚å¤´</button>
        <button class="method-btn" onclick="selectMethod(3)">æ–¹æ³•3: Iframeç»•è¿‡</button>
        <button class="method-btn" onclick="selectMethod(4)">æ–¹æ³•4: å¤šä¸ªä»£ç†è½®è¯¢</button>
    </div>
    
    <button class="btn" onclick="getData()">ğŸš€ å¼€å§‹è·å–æ•°æ®</button>
    <button class="btn" onclick="testAllMethods()">ğŸ§ª æµ‹è¯•æ‰€æœ‰æ–¹æ³•</button>
    <button class="btn" onclick="showResponseDetails()">ğŸ“Š æ˜¾ç¤ºå“åº”è¯¦æƒ…</button>
    
    <div id="result" style="margin-top: 30px; display: none;">
        <h3>è·å–ç»“æœï¼š</h3>
        <pre id="dataOutput"></pre>
        <div id="responseInfo" style="margin-top: 15px;"></div>
    </div>
    
    <div id="debugInfo" style="display: none; margin-top: 20px; padding: 15px; background: #333; color: #0f0; border-radius: 5px;">
        <h3>ğŸ› è°ƒè¯•ä¿¡æ¯</h3>
        <pre id="debugOutput"></pre>
    </div>
    
    <script>
        let currentMethod = 1;
        let debugLogs = [];
        
        function selectMethod(num) {
            currentMethod = num;
            document.querySelectorAll('.method-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            showStatus(`å·²é€‰æ‹©æ–¹æ³• ${num}`, 'info');
        }
        
        function logDebug(msg) {
            debugLogs.push(`[${new Date().toLocaleTimeString()}] ${msg}`);
            console.log(msg);
        }
        
        function showStatus(msg, type = 'info') {
            const status = document.getElementById('status');
            status.innerHTML = msg;
            status.className = `status ${type}`;
            logDebug(`çŠ¶æ€: ${msg}`);
        }
        
        async function getData() {
            showStatus('æ­£åœ¨è·å–æ•°æ®...', 'info');
            logDebug(`å¼€å§‹è·å–ï¼Œä½¿ç”¨æ–¹æ³• ${currentMethod}`);
            
            try {
                let result;
                switch(currentMethod) {
                    case 1: result = await method1(); break;
                    case 2: result = await method2(); break;
                    case 3: result = await method3(); break;
                    case 4: result = await method4(); break;
                }
                
                if (result.success) {
                    displayResult(result.data, result.headers);
                } else {
                    showStatus(`âŒ å¤±è´¥: ${result.error}`, 'error');
                }
                
            } catch (error) {
                showStatus(`âŒ å¼‚å¸¸: ${error.message}`, 'error');
                logDebug(`å¼‚å¸¸: ${error.stack}`);
            }
        }
        
        // æ–¹æ³•1: ç›´æ¥ä»£ç†
        async function method1() {
            logDebug('æ–¹æ³•1: ä½¿ç”¨corsproxy.io');
            try {
                const proxyUrl = 'https://corsproxy.io/?' + encodeURIComponent('http://ttplay.muaini.cn');
                const response = await fetch(proxyUrl);
                
                const text = await response.text();
                const headers = {};
                response.headers.forEach((v, k) => headers[k] = v);
                
                logDebug(`æ–¹æ³•1æˆåŠŸ: ${response.status}, é•¿åº¦: ${text.length}`);
                return { success: true, data: text, headers: headers };
                
            } catch (error) {
                logDebug(`æ–¹æ³•1å¤±è´¥: ${error.message}`);
                return { success: false, error: error.message };
            }
        }
        
        // æ–¹æ³•2: æ·»åŠ è¯·æ±‚å¤´
        async function method2() {
            logDebug('æ–¹æ³•2: æ·»åŠ è¯·æ±‚å¤´ç»•è¿‡CDN');
            try {
                const proxyUrl = 'https://corsproxy.io/?' + encodeURIComponent('http://ttplay.muaini.cn');
                const response = await fetch(proxyUrl, {
                    headers: {
                        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
                        'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',
                        'Accept-Language': 'zh-CN,zh;q=0.9,en;q=0.8',
                        'Accept-Encoding': 'gzip, deflate',
                        'Connection': 'keep-alive',
                        'Upgrade-Insecure-Requests': '1',
                        'Cache-Control': 'max-age=0',
                        'Referer': 'http://ttplay.muaini.cn/',
                        'Origin': 'http://ttplay.muaini.cn'
                    }
                });
                
                const text = await response.text();
                logDebug(`æ–¹æ³•2æˆåŠŸ: ${response.status}, é•¿åº¦: ${text.length}`);
                return { success: true, data: text, headers: {} };
                
            } catch (error) {
                logDebug(`æ–¹æ³•2å¤±è´¥: ${error.message}`);
                return { success: false, error: error.message };
            }
        }
        
        // æ–¹æ³•3: Iframeç»•è¿‡
        async function method3() {
            return new Promise((resolve) => {
                logDebug('æ–¹æ³•3: ä½¿ç”¨IframeæŠ€å·§');
                
                const iframe = document.createElement('iframe');
                iframe.style.display = 'none';
                iframe.sandbox = 'allow-scripts allow-same-origin';
                iframe.srcdoc = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <script>
                            fetch('http://ttplay.muaini.cn')
                                .then(r => r.text())
                                .then(data => {
                                    window.parent.postMessage({
                                        type: 'iframe_data',
                                        data: data
                                    }, '*');
                                })
                                .catch(err => {
                                    window.parent.postMessage({
                                        type: 'iframe_error',
                                        error: err.message
                                    }, '*');
                                });
                        <\/script>
                    </head>
                    <body></body>
                    </html>
                `;
                
                const handler = (event) => {
                    if (event.data.type === 'iframe_data') {
                        document.body.removeChild(iframe);
                        window.removeEventListener('message', handler);
                        logDebug('æ–¹æ³•3æˆåŠŸ via iframe');
                        resolve({ success: true, data: event.data.data, headers: {} });
                    } else if (event.data.type === 'iframe_error') {
                        document.body.removeChild(iframe);
                        window.removeEventListener('message', handler);
                        logDebug(`æ–¹æ³•3å¤±è´¥: ${event.data.error}`);
                        resolve({ success: false, error: event.data.error });
                    }
                };
                
                window.addEventListener('message', handler);
                document.body.appendChild(iframe);
                
                // è¶…æ—¶å¤„ç†
                setTimeout(() => {
                    if (iframe.parentNode) {
                        document.body.removeChild(iframe);
                        window.removeEventListener('message', handler);
                        logDebug('æ–¹æ³•3è¶…æ—¶');
                        resolve({ success: false, error: 'IframeåŠ è½½è¶…æ—¶' });
                    }
                }, 10000);
            });
        }
        
        // æ–¹æ³•4: å¤šä¸ªä»£ç†è½®è¯¢
        async function method4() {
            logDebug('æ–¹æ³•4: å°è¯•å¤šä¸ªä»£ç†');
            
            const proxies = [
                { name: 'allorigins', url: 'https://api.allorigins.win/raw?url=' },
                { name: 'thingproxy', url: 'https://thingproxy.freeboard.io/fetch/' },
                { name: 'corsproxy', url: 'https://corsproxy.io/?' },
                { name: 'corsanywhere', url: 'https://cors-anywhere.herokuapp.com/' }
            ];
            
            for (const proxy of proxies) {
                try {
                    logDebug(`å°è¯•ä»£ç†: ${proxy.name}`);
                    const proxyUrl = proxy.url + encodeURIComponent('http://ttplay.muaini.cn');
                    
                    const response = await fetch(proxyUrl, { 
                        timeout: 8000,
                        headers: { 'X-Requested-With': 'XMLHttpRequest' }
                    });
                    
                    if (response.ok) {
                        const text = await response.text();
                        logDebug(`ä»£ç† ${proxy.name} æˆåŠŸ: é•¿åº¦ ${text.length}`);
                        return { 
                            success: true, 
                            data: text, 
                            headers: {},
                            proxy: proxy.name 
                        };
                    }
                } catch (error) {
                    logDebug(`ä»£ç† ${proxy.name} å¤±è´¥: ${error.message}`);
                    continue;
                }
            }
            
            return { success: false, error: 'æ‰€æœ‰ä»£ç†éƒ½å¤±è´¥äº†' };
        }
        
        function displayResult(data, headers) {
            const resultDiv = document.getElementById('result');
            const output = document.getElementById('dataOutput');
            const infoDiv = document.getElementById('responseInfo');
            
            // æ˜¾ç¤ºæ•°æ®
            output.textContent = data;
            
            // æ˜¾ç¤ºä¿¡æ¯
            let info = `<p><strong>æ•°æ®é•¿åº¦ï¼š</strong> ${data.length} å­—ç¬¦</p>`;
            info += `<p><strong>å‰200å­—ç¬¦ï¼š</strong> ${data.substring(0, 200).replace(/</g, '&lt;').replace(/>/g, '&gt;')}</p>`;
            
            if (headers) {
                info += `<p><strong>å“åº”å¤´ï¼š</strong></p><pre style="font-size:12px;">`;
                for (const [key, value] of Object.entries(headers)) {
                    info += `${key}: ${value}\n`;
                }
                info += `</pre>`;
            }
            
            // åˆ†æå†…å®¹
            if (data.length < 200) {
                info += `<p style="color:#dc3545;">âš ï¸ å“åº”å¤ªçŸ­ï¼Œå¯èƒ½æ˜¯éªŒè¯é¡µé¢æˆ–é”™è¯¯é¡µ</p>`;
            }
            
            if (data.includes('<html') || data.includes('<!DOCTYPE')) {
                info += `<p>âœ… æ£€æµ‹åˆ°HTMLé¡µé¢</p>`;
            }
            
            if (data.includes('cloudflare') || data.includes('CDN') || data.includes('éªŒè¯')) {
                info += `<p style="color:#ffc107;">âš ï¸ å¯èƒ½è§¦å‘äº†CDNéªŒè¯</p>`;
            }
            
            infoDiv.innerHTML = info;
            resultDiv.style.display = 'block';
            
            showStatus(`âœ… è·å–æˆåŠŸï¼é•¿åº¦: ${data.length} å­—ç¬¦`, 'success');
            logDebug(`æ˜¾ç¤ºç»“æœï¼Œé•¿åº¦: ${data.length}`);
        }
        
        async function testAllMethods() {
            showStatus('æµ‹è¯•æ‰€æœ‰æ–¹æ³•ä¸­...', 'info');
            logDebug('å¼€å§‹æµ‹è¯•æ‰€æœ‰æ–¹æ³•');
            
            const methods = [method1, method2, method3, method4];
            const results = [];
            
            for (let i = 0; i < methods.length; i++) {
                showStatus(`æµ‹è¯•æ–¹æ³• ${i+1}...`, 'info');
                try {
                    const result = await methods[i]();
                    results.push({
                        method: i+1,
                        success: result.success,
                        length: result.success ? result.data.length : 0,
                        error: result.error || 'æ— '
                    });
                } catch (error) {
                    results.push({ method: i+1, success: false, error: error.message });
                }
            }
            
            // æ˜¾ç¤ºæµ‹è¯•ç»“æœ
            let testResult = '<h4>æµ‹è¯•ç»“æœï¼š</h4><table style="width:100%; border-collapse:collapse;">';
            testResult += '<tr><th>æ–¹æ³•</th><th>çŠ¶æ€</th><th>é•¿åº¦</th><th>é”™è¯¯</th></tr>';
            
            results.forEach(r => {
                testResult += `<tr>
                    <td>æ–¹æ³• ${r.method}</td>
                    <td>${r.success ? 'âœ… æˆåŠŸ' : 'âŒ å¤±è´¥'}</td>
                    <td>${r.length || '-'}</td>
                    <td>${r.error}</td>
                </tr>`;
            });
            
            testResult += '</table>';
            
            document.getElementById('responseInfo').innerHTML = testResult;
            document.getElementById('result').style.display = 'block';
            
            // æ‰¾å‡ºæœ€å¥½çš„æ–¹æ³•
            const best = results.filter(r => r.success).sort((a,b) => b.length - a.length)[0];
            if (best) {
                showStatus(`æœ€ä½³æ–¹æ³•: æ–¹æ³• ${best.method} (é•¿åº¦: ${best.length})`, 'success');
                selectMethod(best.method);
            }
        }
        
        function showResponseDetails() {
            const debugDiv = document.getElementById('debugInfo');
            const debugOutput = document.getElementById('debugOutput');
            
debugOutput.textContent = debugLogs.join('\n');
debugDiv.style.display = 'block';
}
        
// åˆå§‹åŒ–
window.onload = function() {
showStatus('å°±ç»ªï¼é€‰æ‹©æ–¹æ³•åç‚¹å‡»"å¼€å§‹è·å–æ•°æ®"', 'info');
logDebug('é¡µé¢åŠ è½½å®Œæˆ');
};
        
// æ·»åŠ è¶…æ—¶å¤„ç†
const originalFetch = window.fetch;
window.fetch = function(url, options) {
const timeout = options?.timeout || 15000;
const controller = new AbortController();
const timeoutId = setTimeout(() => controller.abort(), timeout);
            
return originalFetch(url, {
options,
signal: controller.signal
}).finally(() => clearTimeout(timeoutId));
};
    

