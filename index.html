<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TTPlayæ­Œè¯æœåŠ¡å™¨è®¿é—®å·¥å…·</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 10px;
        }
        .subtitle {
            color: #666;
            text-align: center;
            margin-bottom: 30px;
        }
        .btn {
            display: block;
            width: 100%;
            padding: 18px;
            margin: 15px 0;
            background: linear-gradient(135deg, #007acc, #005fa3);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,122,204,0.3);
        }
        .btn:active {
            transform: translateY(0);
        }
        .btn-success {
            background: linear-gradient(135deg, #28a745, #1e7e34);
        }
        .btn-warning {
            background: linear-gradient(135deg, #ffc107, #e0a800);
        }
        .btn-danger {
            background: linear-gradient(135deg, #dc3545, #c82333);
        }
        .status-box {
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            display: none;
            border-left: 5px solid #007acc;
            background: #f8f9fa;
        }
        .status-success {
            border-left-color: #28a745;
            background: #e8f5e8;
        }
        .status-error {
            border-left-color: #dc3545;
            background: #ffe6e6;
        }
        .status-loading {
            border-left-color: #007acc;
            background: #e6f3ff;
        }
        .result-box {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
            border: 2px solid #dee2e6;
        }
        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 8px;
            overflow: auto;
            max-height: 400px;
            font-family: 'Consolas', monospace;
            font-size: 14px;
        }
        .cookie-item {
            background: white;
            padding: 12px;
            margin: 8px 0;
            border-radius: 6px;
            border-left: 4px solid #007acc;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .info-box {
            background: #e7f3ff;
            padding: 20px;
            border-radius: 10px;
            margin: 30px 0;
            border-left: 5px solid #007acc;
        }
        .link-group {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .link-group a {
            flex: 1;
            min-width: 200px;
            padding: 15px;
            background: #6c757d;
            color: white;
            text-align: center;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s;
        }
        .link-group a:hover {
            background: #545b62;
            transform: translateY(-2px);
        }
        .link-group a.primary {
            background: #007acc;
        }
        .link-group a.success {
            background: #28a745;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸµ TTPlayæ­Œè¯æœåŠ¡å™¨è®¿é—®å·¥å…·</h1>
        <p class="subtitle">é€šè¿‡GitHub Pagesè®¿é—® http://ttplay.muaini.cn</p>
        
        <div id="status" class="status-box"></div>
        
        <button class="btn" onclick="getData()" id="fetchBtn">ğŸš€ å¼€å§‹è·å–æ•°æ®</button>
        <button class="btn btn-success" onclick="showCookies()">ğŸª æŸ¥çœ‹Cookie</button>
        <button class="btn btn-warning" onclick="testDirect()">ğŸ”§ æµ‹è¯•è¿æ¥</button>
        <button class="btn btn-danger" onclick="clearCookies()">ğŸ—‘ï¸ æ¸…é™¤Cookie</button>
        
        <div class="link-group">
            <a href="https://github.com/wtflxk/ttplay_cookie_js" target="_blank" class="primary">ğŸ“‚ GitHubä»“åº“</a>
            <a href="http://ttplay.muaini.cn" target="_blank" class="success">ğŸŒ è®¿é—®åŸç½‘ç«™</a>
            <a href="https://wtflxk.github.io/ttplay_cookie_js/proxy.html" target="_blank">ğŸ”— ä»£ç†é¡µé¢</a>
        </div>
        
        <div id="cookieResult" class="result-box"></div>
        
        <div id="dataResult" class="result-box">
            <h3>ğŸ“‹ è·å–åˆ°çš„æ•°æ®</h3>
            <div id="dataContent"></div>
        </div>
        
        <div class="info-box">
            <h3>ğŸ“ ä½¿ç”¨è¯´æ˜</h3>
            <ol>
                <li><strong>ç‚¹å‡»"å¼€å§‹è·å–æ•°æ®"</strong> - ä»TTPlayæœåŠ¡å™¨è·å–æœ€æ–°ä¿¡æ¯</li>
                <li><strong>ç‚¹å‡»"æŸ¥çœ‹Cookie"</strong> - æŸ¥çœ‹å·²ä¿å­˜çš„è®¿é—®æ•°æ®</li>
                <li><strong>ç‚¹å‡»"æµ‹è¯•è¿æ¥"</strong> - æ£€æŸ¥ç½‘ç»œè¿æ¥çŠ¶æ€</li>
                <li><strong>ç‚¹å‡»"æ¸…é™¤Cookie"</strong> - åˆ é™¤æ‰€æœ‰ä¿å­˜çš„æ•°æ®</li>
            </ol>
            <p><strong>æ³¨æ„ï¼š</strong>å¦‚æœè·å–å¤±è´¥ï¼Œå¯èƒ½æ˜¯æœåŠ¡å™¨æš‚æ—¶ä¸å¯è®¿é—®æˆ–ç½‘ç»œé™åˆ¶ã€‚</p>
        </div>
    </div>
    
    <script>
        // æ˜¾ç¤ºçŠ¶æ€ä¿¡æ¯
        function showStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    ${type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : 'â³'}
                    <span>${message}</span>
                </div>
            `;
            status.className = `status-box status-${type}`;
            status.style.display = 'block';
            
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        // ä¸»è·å–æ•°æ®å‡½æ•°
        async function getData() {
            const btn = document.getElementById('fetchBtn');
            const originalText = btn.innerHTML;
            
            btn.disabled = true;
            btn.innerHTML = 'â³ æ­£åœ¨è¿æ¥æœåŠ¡å™¨...';
            
            showStatus('æ­£åœ¨è¿æ¥ TTPlay æœåŠ¡å™¨...', 'loading');
            
            try {
                // ä½¿ç”¨å¯é çš„CORSä»£ç†
                const proxyUrl = 'https://corsproxy.io/?' + encodeURIComponent('http://ttplay.muaini.cn');
                
                console.log('ä½¿ç”¨ä»£ç†URL:', proxyUrl);
                
                const response = await fetch(proxyUrl, {
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest',
                        'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'
                    },
                    mode: 'cors'
                });
                
                console.log('å“åº”çŠ¶æ€:', response.status, response.statusText);
                
                if (response.ok) {
                    const text = await response.text();
                    console.log('è·å–æˆåŠŸï¼Œæ•°æ®é•¿åº¦:', text.length);
                    
                    showStatus('âœ… æˆåŠŸè·å–æ•°æ®ï¼', 'success');
                    
                    // æ˜¾ç¤ºæ•°æ®é¢„è§ˆ
                    displayDataPreview(text);
                    
                    // ä¿å­˜æ•°æ®åˆ°Cookie
                    saveDataToCookies(text);
                    
                } else {
                    throw new Error(`æœåŠ¡å™¨è¿”å›é”™è¯¯: ${response.status} ${response.statusText}`);
                }
                
            } catch (error) {
                console.error('è·å–æ•°æ®å¤±è´¥:', error);
                showStatus(`âŒ è·å–å¤±è´¥: ${error.message}`, 'error');
                
                // å°è¯•å¤‡ç”¨æ–¹æ³•
                setTimeout(() => {
                    showStatus('æ­£åœ¨å°è¯•å¤‡ç”¨æ–¹æ³•...', 'loading');
                    tryBackupMethod();
                }, 1000);
                
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }
        
        // å¤‡ç”¨æ–¹æ³•
        async function tryBackupMethod() {
            try {
                // å°è¯•å…¶ä»–ä»£ç†
                const backupProxies = [
                    'https://api.allorigins.win/raw?url=',
                    'https://thingproxy.freeboard.io/fetch/'
                ];
                
                for (const proxy of backupProxies) {
                    try {
                        const proxyUrl = proxy + encodeURIComponent('http://ttplay.muaini.cn');
                        console.log('å°è¯•å¤‡ç”¨ä»£ç†:', proxyUrl);
                        
                        const response = await fetch(proxyUrl, { timeout: 10000 });
                        
                        if (response.ok) {
                            const text = await response.text();
                            showStatus('âœ… é€šè¿‡å¤‡ç”¨æ–¹æ³•è·å–æˆåŠŸï¼', 'success');
                            displayDataPreview(text);
                            saveDataToCookies(text);
                            return;
                        }
                    } catch (err) {
                        console.log('å¤‡ç”¨ä»£ç†å¤±è´¥:', err.message);
                        continue;
                    }
                }
                
                throw new Error('æ‰€æœ‰å¤‡ç”¨æ–¹æ³•éƒ½å¤±è´¥äº†');
                
            } catch (error) {
                showStatus(`âŒ å¤‡ç”¨æ–¹æ³•ä¹Ÿå¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // æ˜¾ç¤ºæ•°æ®é¢„è§ˆ
        function displayDataPreview(text) {
            const dataResult = document.getElementById('dataResult');
            const dataContent = document.getElementById('dataContent');
            
            // æå–æ ‡é¢˜
            const titleMatch = text.match(/<title>(.*?)<\/title>/i);
            const title = titleMatch ? titleMatch[1] : 'æ— æ ‡é¢˜';
            
            // æå–å…³é”®ä¿¡æ¯
            const info = {
                title: title,
                length: text.length,
                hasDownload: text.includes('ä¸‹è½½') || text.includes('download'),
                hasPassword: text.includes('å¯†ç ') || text.includes('password'),
                updateTime: text.match(/\d{4}-\d{2}-\d{2}/)?.[0] || 'æœªçŸ¥'
            };
            
            dataContent.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <h4>ğŸ“„ é¡µé¢ä¿¡æ¯</h4>
                    <p><strong>æ ‡é¢˜ï¼š</strong>${info.title}</p>
                    <p><strong>æ•°æ®é•¿åº¦ï¼š</strong>${info.length} å­—ç¬¦</p>
                    <p><strong>æ›´æ–°æ—¶é—´ï¼š</strong>${info.updateTime}</p>
                    <p><strong>åŒ…å«ä¸‹è½½ï¼š</strong>${info.hasDownload ? 'æ˜¯' : 'å¦'}</p>
                    <p><strong>åŒ…å«å¯†ç ï¼š</strong>${info.hasPassword ? 'æ˜¯' : 'å¦'}</p>
                </div>
                <div>
                    <h4>ğŸ“ æ•°æ®é¢„è§ˆï¼ˆå‰500å­—ç¬¦ï¼‰</h4>
                    <pre>${escapeHtml(text.substring(0, 500))}...</pre>
                </div>
                <button class="btn" onclick="viewFullData()" style="margin-top: 15px; padding: 10px 20px; font-size: 16px;">
                    æŸ¥çœ‹å®Œæ•´æ•°æ®
                </button>
            `;
            
            dataResult.style.display = 'block';
        }
        
        // æŸ¥çœ‹å®Œæ•´æ•°æ®
        function viewFullData() {
            const data = getCookie('ttplay_full_data');
            if (data) {
                try {
                    const fullText = decodeURIComponent(atob(data));
                    document.getElementById('dataContent').innerHTML = `
                        <h4>ğŸ“‹ å®Œæ•´æ•°æ®</h4>
                        <pre style="max-height: 500px;">${escapeHtml(fullText)}</pre>
                        <button class="btn" onclick="displayDataPreview(fullText)" style="margin-top: 15px;">
                            è¿”å›é¢„è§ˆ
                        </button>
                    `;
                } catch (e) {
                    alert('æ— æ³•è§£æå®Œæ•´æ•°æ®ï¼š' + e.message);
                }
            } else {
                alert('æ²¡æœ‰æ‰¾åˆ°ä¿å­˜çš„å®Œæ•´æ•°æ®');
            }
        }
        
        // ä¿å­˜æ•°æ®åˆ°Cookie
        function saveDataToCookies(text) {
            // ä¿å­˜å®Œæ•´æ•°æ®ï¼ˆbase64ç¼–ç ï¼‰
            const encodedData = btoa(encodeURIComponent(text));
            setCookie('ttplay_full_data', encodedData, 7);
            
            // ä¿å­˜è®¿é—®æ—¶é—´
            setCookie('ttplay_last_access', new Date().toISOString(), 7);
            
            // æå–å¹¶ä¿å­˜å…³é”®ä¿¡æ¯
            const passwordMatch = text.match(/ä¸‹è½½å¯†ç [ï¼š:]\s*(\w+)/);
            if (passwordMatch) {
                setCookie('ttplay_download_password', passwordMatch[1], 7);
            }
            
            const updateMatch = text.match(/(\d{4}-\d{2}-\d{2})æ›´æ–°/);
            if (updateMatch) {
                setCookie('ttplay_update_date', updateMatch[1], 7);
            }
            
            console.log('æ•°æ®å·²ä¿å­˜åˆ°Cookie');
        }
        
        // HTMLè½¬ä¹‰
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // è®¾ç½®Cookie
        function setCookie(name, value, days) {
            const expires = new Date();
            expires.setTime(expires.getTime() + days * 24 * 60 * 60 * 1000);
            document.cookie = `${name}=${value};expires=${expires.toUTCString()};path=/;SameSite=Lax`;
        }
        
        // è·å–Cookie
        function getCookie(name) {
            const cookies = document.cookie.split(';');
            for (let cookie of cookies) {
                const [key, value] = cookie.trim().split('=');
                if (key === name) return decodeURIComponent(value);
            }
            return null;
        }
        
        // æ˜¾ç¤ºCookie
        function showCookies() {
            const cookies = document.cookie;
            const result = document.getElementById('cookieResult');
            
            if (!cookies) {
                result.innerHTML = '<p style="text-align: center; color: #666;">æš‚æ— Cookieæ•°æ®</p>';
            } else {
                let html = '<h3>ğŸª å½“å‰Cookieæ•°æ®</h3>';
                const cookieList = cookies.split(';').filter(c => c.trim());
                
                cookieList.forEach(cookie => {
                    const [name, value] = cookie.trim().split('=');
                    const decodedValue = decodeURIComponent(value || '');
                    const displayValue = decodedValue.length > 50 ? 
                        decodedValue.substring(0, 50) + '...' : decodedValue;
                    
                    html += `
                        <div class="cookie-item">
                            <span><strong>${name}</strong></span>
                            <span style="color: #666; font-size: 14px;">${displayValue}</span>
                        </div>
                    `;
                });
                
                result.innerHTML = html;
            }
            
            result.style.display = 'block';
        }
        
        // æ¸…é™¤Cookie
        function clearCookies() {
            document.cookie.split(';').forEach(cookie => {
                const name = cookie.split('=')[0].trim();
                document.cookie = `${name}=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/`;
            });
            
            showStatus('âœ… æ‰€æœ‰Cookieå·²æ¸…é™¤', 'success');
            document.getElementById('cookieResult').style.display = 'none';
            document.getElementById('dataResult').style.display = 'none';
        }
        
        // æµ‹è¯•ç›´æ¥è¿æ¥
        async function testDirect() {
            showStatus('æ­£åœ¨æµ‹è¯•ç›´æ¥è¿æ¥...', 'loading');
            
            try {
                // å°è¯•ç›´æ¥è¿æ¥ï¼ˆå¯èƒ½ä¼šè¢«CORSé˜»æ­¢ï¼‰
                const response = await fetch('http://ttplay.muaini.cn', { 
                    mode: 'no-cors',
                    cache: 'no-cache'
                });
                
                // no-corsæ¨¡å¼ä¸æŠ¥é”™å°±è®¤ä¸ºè¿æ¥æˆåŠŸ
                showStatus('âœ… å¯ä»¥è¿æ¥åˆ°æœåŠ¡å™¨ï¼ˆä½†æ— æ³•ç›´æ¥è¯»å–æ•°æ®ï¼‰', 'success');
                
            } catch (error) {
                
            
        
        
        
        
            
            
            
            
                
                





            
            
            
        
    

